<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Imprimir Etiquetas - Biblioteca</title>
  <style>
    /* El CSS que proporcionaste (solo el que quieres aplicar) */
    /* Estilos base */
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      position: relative;
    }
    
    .controls {
      margin-bottom: 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .controls h1 {
      color: #2c3e50;
      margin: 0;
      font-size: 1.5rem;
    }
    
    .print-btn, .back-btn {
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      font-size: 16px;
    }
    
    .print-btn {
      background: #27ae60;
      color: white;
    }
    
    .back-btn {
      background: #3498db;
      color: white;
    }
    
    .label-container {
      display: grid;
      grid-template-columns: repeat(3, 65mm);
      grid-auto-rows: 45mm;
      gap: 7mm;
      justify-content: center;
      margin: 20px 0;
    }
    
    .label {
      width: 65mm;
      height: 45mm;
      border: 1px solid #ddd;
      padding: 12px;
      background: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      font-family: 'Arial', sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      box-sizing: border-box;
    }
    
    .label-content {
      display: flex;
      flex-direction: column;
      gap: 8px;
      flex-grow: 1;
    }
    
    .book-title {
      font-size: 12pt;
      font-weight: bold;
      text-align: center;
      line-height: 1.2;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
    
    .book-author {
      font-size: 9pt;
      text-align: center;
      font-style: italic;
      color: #6a7480;
      margin-bottom: 6px;
    }
    
    .book-code {
      text-align: center;
      font-family: 'Courier New', monospace;
      font-size: 10pt;
      font-weight: bold;
      margin: 4px 0;
      user-select: all;
    }
    
    .book-details {
      font-size: 8pt;
      color: #4b5d6b;
      display: flex;
      justify-content: space-around;
      border-top: 1px solid #d4dce6;
      border-bottom: 1px solid #d4dce6;
      padding: 4px 0;
      background: #f7fbff;
      border-radius: 6px;
      box-shadow: inset 0 1px 3px #e5eefa;
      user-select: none;
    }
    
    .book-details div {
      flex: 1;
      text-align: center;
      font-weight: 600;
      letter-spacing: 0.04em;
      color: #2c3e50;
    }
    
    .book-details div:not(:last-child) {
      border-right: 1px solid #cdd7e4;
    }
    
    .footer {
      font-size: 7pt;
      text-align: center;
      color: #666;
      margin-top: 6px;
      user-select: none;
      letter-spacing: 0.06em;
    }

    .barcode {
      display: block;
      margin: 6px auto 0;
      height: 30px;
      width: 100%;
    }

    /* Impresión */
    @media print {
      body * {
        visibility: hidden;
      }
      .label-container, .label-container * {
        visibility: visible;
      }
      .label-container {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        display: grid;
        grid-template-columns: repeat(3, 65mm);
        grid-auto-rows: 45mm;
        gap: 7mm;
        margin: 0;
        padding: 0;
      }
      .label {
        border: none !important;
        box-shadow: none !important;
        margin: 0 !important;
        padding: 3mm !important;
        page-break-after: avoid;
        page-break-inside: avoid;
        font-family: Arial, sans-serif !important;
        width: 65mm !important;
        height: 45mm !important;
      }
      .book-title {
        font-size: 12pt !important;
        margin-bottom: 1mm !important;
      }
      .book-author {
        font-size: 9pt !important;
        margin-bottom: 2mm !important;
      }
      .book-code {
        font-size: 10pt !important;
        margin: 1mm 0 !important;
      }
      .barcode {
        height: 15mm !important;
        margin-bottom: 1mm !important;
      }
      .book-details {
        font-size: 8pt !important;
        line-height: 1.3 !important;
        margin-top: 2mm !important;
      }
      .footer {
        font-size: 7pt !important;
        margin-top: 2mm !important;
      }
      @page {
        size: A4 portrait;
        margin: 15mm;
      }
    }
  </style>
</head>
<body>
  <div id="labels" class="label-container"></div>

  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const etiquetas = JSON.parse(sessionStorage.getItem('etiquetasParaImprimir') || '[]');
      const container = document.getElementById('labels');

      if (etiquetas.length === 0) {
        container.innerHTML = '<p style="text-align:center; color:#999; font-size:14pt; margin-top: 40vh;">No hay etiquetas para imprimir.</p>';
        return;
      }

      etiquetas.forEach((etiqueta, index) => {
        const label = document.createElement('div');
        label.className = 'label';

        label.innerHTML = `
          <div class="label-content">
            <div class="book-title">${etiqueta.titulo}</div>
            <div class="book-author">${etiqueta.autor}</div>
            <div class="book-code">${etiqueta.isbn}</div>
            <svg class="barcode" id="barcode-${index}"></svg>
            <div class="book-details">
              <div><strong>Código</strong><br>${etiqueta.codigo || 'N/A'}</div>
              <div><strong>Ubicación</strong><br>${etiqueta.ubicacion || 'N/A'}</div>
              <div><strong>Ejemplar</strong><br>${etiqueta.ejemplar || 'N/A'}</div>
            </div>
          </div>
          <div class="footer">© ${new Date().getFullYear()} Biblioteca Escolar</div>
        `;

        container.appendChild(label);

        JsBarcode(`#barcode-${index}`, etiqueta.isbn, {
          format: 'CODE128',
          lineColor: '#1B396A',
          width: 1.2,
          height: 30,
          displayValue: false,
          margin: 0,
        });
      });

      setTimeout(() => window.print(), 1000);
    });
  </script>
</body>
</html>

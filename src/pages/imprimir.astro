<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Imprimir Etiquetas - Biblioteca</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
    
    body {
      font-family: 'Roboto', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 15mm;
      background: #f0f4f8;
      color: #2C3E50;
    }
    .labels-print-container {
      display: grid;
      grid-template-columns: repeat(3, 65mm);
      grid-template-rows: repeat(8, 45mm);
      gap: 7mm;
      width: 210mm;
      height: 297mm;
      box-sizing: border-box;
    }
    .label-print {
      background: #fff;
      border-radius: 14px;
      box-shadow:
        0 4px 8px rgba(0,0,0,0.12),
        inset 0 0 8px #e6f0ff;
      padding: 14px 16px 16px;
      box-sizing: border-box;
      display: grid;
      grid-template-rows: 22px auto auto 1fr auto;
      position: relative;
      border: 1.5px solid #d1d9e6;
      transition: transform 0.2s ease;
    }
    .label-print:hover {
      transform: translateY(-4px);
      box-shadow:
        0 10px 20px rgba(0,0,0,0.15),
        inset 0 0 12px #cce0ff;
    }
    .label-print::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 8px;
      background: linear-gradient(90deg, #264e86, #1a365d);
      border-radius: 14px 14px 0 0;
      box-shadow: 0 2px 6px rgba(26, 54, 93, 0.6);
      z-index: 2;
    }
    .label-print-header {
      color: #fff;
      font-weight: 700;
      font-size: 9pt;
      text-align: center;
      user-select: none;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      margin: 0;
      z-index: 3;
      position: relative;
      line-height: 1.3;
      text-shadow: 0 0 3px rgba(0,0,0,0.2);
    }
    .label-print-title {
      font-weight: 700;
      font-size: 12pt;
      color: #1B396A;
      margin: 12px 0 6px;
      text-align: center;
      line-height: 1.25;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      padding: 0 8px;
      text-shadow: 0 1px 1px rgba(0,0,0,0.05);
    }
    .label-print-author {
      font-style: italic;
      font-size: 9pt;
      text-align: center;
      color: #6a7480;
      margin-bottom: 12px;
      user-select: text;
      padding: 0 8px;
    }
    .label-print-info {
      font-size: 8.5pt;
      color: #4b5d6b;
      display: flex;
      justify-content: space-around;
      margin-bottom: 12px;
      border-top: 1px solid #d4dce6;
      border-bottom: 1px solid #d4dce6;
      padding: 6px 0;
      background: #f7fbff;
      user-select: none;
      border-radius: 8px;
      box-shadow: inset 0 1px 3px #e5eefa;
    }
    .label-print-info div {
      flex: 1;
      text-align: center;
      border-right: 1px solid #cdd7e4;
      padding: 0 6px;
      font-weight: 600;
      letter-spacing: 0.04em;
      color: #2c3e50;
    }
    .label-print-info div:last-child {
      border-right: none;
    }
    .label-print-info strong {
      display: block;
      color: #264e86;
      font-weight: 700;
      margin-bottom: 4px;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      font-size: 7.5pt;
    }
    .label-print-code {
      font-family: 'Courier New', Courier, monospace;
      font-weight: 700;
      font-size: 9pt;
      text-align: center;
      color: #1B396A;
      margin-bottom: 14px;
      user-select: text;
      background: linear-gradient(90deg, #e9eff7, #f0f5fd, #e9eff7);
      padding: 6px 10px;
      border-radius: 6px;
      letter-spacing: 0.08em;
      box-shadow: inset 0 0 8px rgba(27, 57, 106, 0.15);
      border: 1px solid #a8b6cf;
      user-select: all;
    }
    .label-print-barcode {
      display: block;
      margin: 0 auto 10px;
      width: 100%;
      height: 42px;
      filter: drop-shadow(0 2px 2px rgba(0,0,0,0.12));
      background: #f8fafc;
      padding: 5px;
      border-radius: 6px;
      border: 1px solid #d5dce8;
      box-shadow: 0 1px 4px rgba(100, 120, 160, 0.1);
    }
    .label-print-footer {
      font-size: 7pt;
      text-align: center;
      border-top: 1px dashed #b0b8c5;
      margin-top: 10px;
      padding-top: 6px;
      color: #5f6d7a;
      user-select: none;
      letter-spacing: 0.06em;
      background: linear-gradient(90deg, #f0f5fc, #d9e3f1);
      border-radius: 0 0 14px 14px;
      box-shadow: inset 0 3px 4px rgba(255,255,255,0.6);
    }
    /* Decoraciones puntuales */
    .label-print::after {
      content: "";
      position: absolute;
      width: 10px;
      height: 10px;
      background: #264e86;
      border-radius: 50%;
      bottom: 8px;
      left: 8px;
      opacity: 0.2;
      box-shadow: 0 0 6px #264e86aa;
    }
    .label-print .corner-dot {
      position: absolute;
      width: 10px;
      height: 10px;
      background: #264e86;
      border-radius: 50%;
      bottom: 8px;
      right: 8px;
      opacity: 0.2;
      box-shadow: 0 0 6px #264e86aa;
    }
    @page {
      size: A4 portrait;
      margin: 15mm;
    }
  </style>
</head>
<body>
  <div id="labels" class="labels-print-container"></div>

  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const etiquetas = JSON.parse(sessionStorage.getItem('etiquetasParaImprimir') || '[]');
      const container = document.getElementById('labels');

      if (etiquetas.length === 0) {
        container.innerHTML = '<p style="text-align:center; color:#999; font-size:14pt; margin-top: 40vh;">No hay etiquetas para imprimir.</p>';
        return;
      }

      etiquetas.forEach((etiqueta, index) => {
        const label = document.createElement('div');
        label.className = 'label-print';

        label.innerHTML = `
          <div class="label-print-header">Biblioteca Escolar</div>
          <div class="label-print-title">${etiqueta.titulo}</div>
          <div class="label-print-author">${etiqueta.autor}</div>
          <div class="label-print-info">
            <div><strong>Código</strong>${etiqueta.codigo || 'N/A'}</div>
            <div><strong>Ubicación</strong>${etiqueta.ubicacion || 'N/A'}</div>
            <div><strong>Ejemplar</strong>${etiqueta.ejemplar || 'N/A'}</div>
          </div>
          <div class="label-print-code">${etiqueta.isbn}</div>
          <svg class="label-print-barcode" id="barcode-${index}"></svg>
          <div class="label-print-footer">© ${new Date().getFullYear()} Biblioteca Escolar</div>
          <div class="corner-dot"></div>
        `;

        container.appendChild(label);

        JsBarcode(`#barcode-${index}`, etiqueta.isbn, {
          format: 'CODE128',
          lineColor: '#1B396A',
          width: 1.5,
          height: 42,
          displayValue: false,
          margin: 0,
        });
      });

      setTimeout(() => window.print(), 1000);
    });
  </script>
</body>
</html>
